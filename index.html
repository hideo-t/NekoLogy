<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#1a1a2e">
<title>NekoLogy - çŒ«æˆåˆ†è§£æ</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700;900&family=Fredoka:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --pink: #FF6B9D;
  --pink-light: #FFB3D0;
  --orange: #FF9A56;
  --yellow: #FFD93D;
  --mint: #6BCB77;
  --sky: #4FC3F7;
  --purple: #AB83E6;
  --lavender: #D4A5FF;
  --bg: #FFF5F7;
  --card: #FFFFFF;
  --text: #2D2B3D;
  --text-light: #8B87A0;
  --shadow: 0 4px 20px rgba(255,107,157,0.15);
  --shadow-lg: 0 8px 32px rgba(255,107,157,0.2);
  --radius: 20px;
  --radius-sm: 14px;
  --transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
html, body { 
  height: 100%; 
  overflow: hidden;
  font-family: 'Zen Maru Gothic', sans-serif;
  background: var(--bg);
  color: var(--text);
}

#app {
  width: 100%;
  height: 100%;
  max-width: 430px;
  margin: 0 auto;
  position: relative;
  overflow: hidden;
}

.screen {
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  display: none;
  flex-direction: column;
  overflow-y: auto;
  overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
  background: var(--bg);
}
.screen.active { display: flex; }
.screen.fade-in { animation: fadeIn 0.4s ease; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: none; } }

/* ===== SPLASH ===== */
#splash {
  background: #1a1a2e;
  justify-content: center;
  align-items: center;
  cursor: pointer;
}
.splash-cat {
  position: relative;
  width: 180px;
  height: 180px;
}
.cat-silhouette {
  width: 100%;
  height: 100%;
}
.cat-eyes {
  position: absolute;
  top: 55px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 30px;
}
.cat-eye {
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: #FFD93D;
  box-shadow: 0 0 20px #FFD93D, 0 0 40px rgba(255,217,61,0.4);
  animation: eyeGlow 3s ease-in-out infinite;
}
.cat-eye:nth-child(2) { animation-delay: 0.2s; }
@keyframes eyeGlow {
  0%,100% { opacity: 0.4; transform: scale(0.8); box-shadow: 0 0 10px #FFD93D; }
  50% { opacity: 1; transform: scale(1.1); box-shadow: 0 0 30px #FFD93D, 0 0 60px rgba(255,217,61,0.5); }
}
.splash-logo {
  font-family: 'Fredoka', sans-serif;
  font-size: 42px;
  font-weight: 700;
  color: white;
  margin-top: 24px;
  letter-spacing: 3px;
  text-shadow: 0 0 30px rgba(255,107,157,0.6);
  animation: logoFloat 4s ease-in-out infinite;
}
@keyframes logoFloat {
  0%,100% { transform: translateY(0); }
  50% { transform: translateY(-6px); }
}
.splash-sub {
  color: rgba(255,255,255,0.5);
  font-size: 13px;
  margin-top: 10px;
  letter-spacing: 1px;
}
.splash-tap {
  color: rgba(255,255,255,0.4);
  font-size: 12px;
  margin-top: 50px;
  animation: tapPulse 2s ease-in-out infinite;
}
@keyframes tapPulse {
  0%,100% { opacity: 0.3; }
  50% { opacity: 0.8; }
}

/* ===== HEADER ===== */
.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 20px 10px;
  position: sticky;
  top: 0;
  background: var(--bg);
  z-index: 10;
}
.header-logo {
  font-family: 'Fredoka', sans-serif;
  font-weight: 700;
  font-size: 22px;
  background: linear-gradient(135deg, var(--pink), var(--orange));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
.header-icons { display: flex; gap: 8px; }
.header-icon {
  width: 36px; height: 36px;
  border-radius: 12px;
  border: none;
  background: white;
  font-size: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: var(--shadow);
  cursor: pointer;
  transition: var(--transition);
}
.header-icon:active { transform: scale(0.9); }

.back-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  background: none;
  border: none;
  font-family: inherit;
  font-size: 15px;
  color: var(--pink);
  font-weight: 700;
  cursor: pointer;
  padding: 4px 0;
}

/* ===== HOME ===== */
.home-content { padding: 0 20px 100px; }

.daily-cat-card {
  background: linear-gradient(135deg, #FFE0EC, #FFF0E0, #E0F0FF);
  border-radius: var(--radius);
  padding: 24px;
  text-align: center;
  margin-bottom: 16px;
  box-shadow: var(--shadow);
  position: relative;
  overflow: hidden;
}
.daily-cat-card::before {
  content: '';
  position: absolute;
  top: -30px; right: -30px;
  width: 100px; height: 100px;
  background: rgba(255,107,157,0.1);
  border-radius: 50%;
}
.daily-label {
  font-size: 13px;
  color: var(--text-light);
  font-weight: 700;
  margin-bottom: 8px;
}
.daily-cat-emoji {
  font-size: 64px;
  display: block;
  margin: 8px 0;
  animation: catBounce 3s ease-in-out infinite;
}
@keyframes catBounce {
  0%,100% { transform: translateY(0) rotate(-2deg); }
  25% { transform: translateY(-8px) rotate(2deg); }
  75% { transform: translateY(-4px) rotate(-1deg); }
}
.daily-cat-name {
  font-size: 20px;
  font-weight: 900;
  margin: 4px 0;
}
.daily-cat-desc {
  font-size: 13px;
  color: var(--text-light);
}

.streak-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  background: white;
  border-radius: 30px;
  padding: 8px 16px;
  font-size: 13px;
  font-weight: 700;
  box-shadow: var(--shadow);
  margin: 12px 0;
  color: var(--orange);
}

.menu-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-top: 16px;
}
.menu-card {
  background: var(--card);
  border-radius: var(--radius-sm);
  padding: 20px 16px;
  text-align: center;
  box-shadow: var(--shadow);
  cursor: pointer;
  transition: var(--transition);
  border: 2px solid transparent;
  position: relative;
  overflow: hidden;
}
.menu-card:active { transform: scale(0.95); }
.menu-card:nth-child(1) { border-color: var(--pink-light); }
.menu-card:nth-child(2) { border-color: #B3E5C7; }
.menu-card:nth-child(3) { border-color: #B3D4FF; }
.menu-card:nth-child(4) { border-color: #FFD9B3; }
.menu-card .mc-emoji {
  font-size: 32px;
  display: block;
  margin-bottom: 8px;
}
.menu-card .mc-title {
  font-size: 14px;
  font-weight: 900;
}
.menu-card .mc-sub {
  font-size: 11px;
  color: var(--text-light);
  margin-top: 4px;
}
.menu-card .mc-badge {
  position: absolute;
  top: 8px; right: 8px;
  background: var(--pink);
  color: white;
  font-size: 10px;
  font-weight: 700;
  padding: 2px 8px;
  border-radius: 10px;
}

/* ===== TAB BAR ===== */
.tab-bar {
  position: fixed;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 100%;
  max-width: 430px;
  display: flex;
  background: white;
  border-top: 1px solid rgba(0,0,0,0.05);
  padding: 8px 0 max(8px, env(safe-area-inset-bottom));
  z-index: 100;
  box-shadow: 0 -4px 20px rgba(0,0,0,0.05);
}
.tab-item {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
  border: none;
  background: none;
  font-family: inherit;
  font-size: 10px;
  color: var(--text-light);
  cursor: pointer;
  padding: 4px 0;
  transition: var(--transition);
}
.tab-item.active { color: var(--pink); }
.tab-item .tab-icon { font-size: 22px; }
.tab-item.active .tab-icon { transform: scale(1.15); }

/* ===== DIAGNOSIS SELECT ===== */
.diag-select-content { padding: 0 20px 100px; }
.diag-option {
  background: var(--card);
  border-radius: var(--radius);
  padding: 24px;
  margin-bottom: 14px;
  box-shadow: var(--shadow);
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  gap: 16px;
  border-left: 5px solid;
}
.diag-option:active { transform: scale(0.97); }
.diag-option:nth-child(1) { border-left-color: var(--pink); }
.diag-option:nth-child(2) { border-left-color: var(--sky); }
.diag-option:nth-child(3) { border-left-color: var(--yellow); }
.diag-option .do-emoji { font-size: 40px; }
.diag-option .do-title { font-size: 16px; font-weight: 900; }
.diag-option .do-desc { font-size: 12px; color: var(--text-light); margin-top: 4px; }
.diag-option .do-badge {
  margin-top: 6px;
  display: inline-block;
  font-size: 10px;
  font-weight: 700;
  padding: 3px 10px;
  border-radius: 20px;
  background: #FFF0F5;
  color: var(--pink);
}

/* ===== QUIZ ===== */
.quiz-content { padding: 0 20px 40px; flex: 1; display: flex; flex-direction: column; }
.quiz-progress {
  display: flex;
  gap: 6px;
  margin: 10px 0 20px;
}
.quiz-dot {
  flex: 1;
  height: 6px;
  border-radius: 3px;
  background: #EEE;
  transition: background 0.3s;
}
.quiz-dot.done { background: linear-gradient(90deg, var(--pink), var(--orange)); }
.quiz-dot.current { background: var(--yellow); animation: dotPulse 1s ease-in-out infinite; }
@keyframes dotPulse { 0%,100%{opacity:0.6} 50%{opacity:1} }

.quiz-qnum {
  font-size: 13px;
  font-weight: 700;
  color: var(--pink);
  margin-bottom: 6px;
}
.quiz-question {
  font-size: 19px;
  font-weight: 900;
  margin-bottom: 24px;
  line-height: 1.5;
}
.quiz-options { display: flex; flex-direction: column; gap: 10px; flex: 1; }
.quiz-opt {
  background: var(--card);
  border: 2px solid #F0EEF5;
  border-radius: var(--radius-sm);
  padding: 16px 20px;
  font-family: inherit;
  font-size: 15px;
  font-weight: 500;
  cursor: pointer;
  transition: var(--transition);
  text-align: left;
  display: flex;
  align-items: center;
  gap: 12px;
}
.quiz-opt:active { transform: scale(0.97); }
.quiz-opt.selected {
  border-color: var(--pink);
  background: #FFF0F5;
  transform: scale(1.02);
}
.quiz-opt .opt-num {
  width: 28px; height: 28px;
  border-radius: 50%;
  background: #F5F3FA;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 13px;
  font-weight: 700;
  color: var(--text-light);
  flex-shrink: 0;
}
.quiz-opt.selected .opt-num {
  background: var(--pink);
  color: white;
}

/* ===== RESULT ===== */
.result-content {
  padding: 0 20px 40px;
  text-align: center;
}
.result-card {
  background: var(--card);
  border-radius: var(--radius);
  padding: 32px 24px;
  box-shadow: var(--shadow-lg);
  margin-bottom: 16px;
  position: relative;
  overflow: hidden;
}
.result-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 6px;
  background: linear-gradient(90deg, var(--pink), var(--orange), var(--yellow), var(--mint), var(--sky), var(--purple));
}
.result-label {
  font-size: 13px;
  font-weight: 700;
  color: var(--text-light);
  margin-bottom: 10px;
}
.result-emoji {
  font-size: 80px;
  display: block;
  margin: 10px 0;
  animation: resultPop 0.6s cubic-bezier(0.34,1.56,0.64,1);
}
@keyframes resultPop { from { transform: scale(0) rotate(-20deg); } to { transform: scale(1) rotate(0); } }
.result-name {
  font-size: 26px;
  font-weight: 900;
  margin: 8px 0;
}
.result-tags {
  display: flex;
  justify-content: center;
  gap: 6px;
  flex-wrap: wrap;
  margin: 10px 0;
}
.result-tag {
  background: #FFF0F5;
  color: var(--pink);
  font-size: 12px;
  font-weight: 700;
  padding: 4px 12px;
  border-radius: 20px;
}
.result-desc {
  font-size: 14px;
  line-height: 1.7;
  color: var(--text);
  margin-top: 16px;
  text-align: left;
  padding: 16px;
  background: #FAFAFE;
  border-radius: var(--radius-sm);
}
.result-bars {
  margin-top: 16px;
  text-align: left;
}
.bar-item {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
}
.bar-label {
  font-size: 12px;
  font-weight: 700;
  width: 90px;
  flex-shrink: 0;
}
.bar-track {
  flex: 1;
  height: 12px;
  background: #F0EEF5;
  border-radius: 6px;
  overflow: hidden;
}
.bar-fill {
  height: 100%;
  border-radius: 6px;
  transition: width 1s cubic-bezier(0.34,1.56,0.64,1);
  width: 0;
}
.bar-pct {
  font-size: 12px;
  font-weight: 700;
  color: var(--text-light);
  width: 36px;
  text-align: right;
}

.action-btn {
  display: block;
  width: 100%;
  padding: 16px;
  border: none;
  border-radius: var(--radius-sm);
  font-family: inherit;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  transition: var(--transition);
  margin-top: 10px;
}
.action-btn:active { transform: scale(0.97); }
.btn-primary {
  background: linear-gradient(135deg, var(--pink), var(--orange));
  color: white;
  box-shadow: 0 4px 15px rgba(255,107,157,0.3);
}
.btn-secondary {
  background: white;
  color: var(--pink);
  border: 2px solid var(--pink-light);
}
.btn-accent {
  background: linear-gradient(135deg, var(--sky), var(--purple));
  color: white;
  box-shadow: 0 4px 15px rgba(79,195,247,0.3);
}

/* ===== COMPATIBILITY ===== */
.compat-hearts {
  font-size: 40px;
  margin: 10px 0;
  animation: heartBeat 1.5s ease-in-out infinite;
}
@keyframes heartBeat {
  0%,100% { transform: scale(1); }
  15% { transform: scale(1.15); }
  30% { transform: scale(1); }
  45% { transform: scale(1.1); }
}
.compat-pair {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 16px;
  margin: 16px 0;
}
.compat-cat {
  text-align: center;
}
.compat-cat-emoji { font-size: 48px; display: block; }
.compat-cat-name { font-size: 12px; font-weight: 700; margin-top: 4px; }
.compat-x { font-size: 24px; color: var(--pink); font-weight: 900; }
.compat-score {
  font-size: 52px;
  font-weight: 900;
  background: linear-gradient(135deg, var(--pink), var(--orange));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
.compat-msg {
  font-size: 14px;
  line-height: 1.8;
  text-align: left;
  padding: 16px;
  background: linear-gradient(135deg, #FFF5F8, #F5F0FF);
  border-radius: var(--radius-sm);
  margin-top: 16px;
}

/* ===== NEKO LOG ===== */
.log-content { padding: 0 20px 100px; }
.log-date {
  font-size: 14px;
  color: var(--text-light);
  font-weight: 700;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.log-checks { display: flex; flex-direction: column; gap: 8px; }
.log-check {
  display: flex;
  align-items: center;
  gap: 12px;
  background: var(--card);
  border-radius: var(--radius-sm);
  padding: 14px 16px;
  box-shadow: var(--shadow);
  cursor: pointer;
  transition: var(--transition);
  border: 2px solid transparent;
}
.log-check.checked { border-color: var(--mint); background: #F0FFF4; }
.log-check:active { transform: scale(0.98); }
.log-checkbox {
  width: 26px; height: 26px;
  border-radius: 8px;
  border: 2px solid #DDD;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  flex-shrink: 0;
  transition: var(--transition);
}
.log-check.checked .log-checkbox {
  background: var(--mint);
  border-color: var(--mint);
  color: white;
}
.log-check-text { font-size: 14px; font-weight: 500; }
.log-check-emoji { font-size: 20px; }

.log-result-card {
  background: var(--card);
  border-radius: var(--radius);
  padding: 20px;
  margin-top: 20px;
  box-shadow: var(--shadow);
}
.log-result-title {
  font-size: 14px;
  font-weight: 700;
  margin-bottom: 12px;
  color: var(--pink);
}

/* ===== NEKOGRAM ===== */
.gram-content { padding: 0 20px 100px; }
.gram-card {
  background: var(--card);
  border-radius: var(--radius);
  padding: 24px;
  box-shadow: var(--shadow);
  margin-bottom: 16px;
}
.gram-title { font-size: 16px; font-weight: 900; margin-bottom: 16px; }
.chart-container {
  width: 200px;
  height: 200px;
  margin: 0 auto 16px;
  position: relative;
}
.chart-canvas { width: 100%; height: 100%; }
.chart-center {
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%,-50%);
  text-align: center;
}
.chart-center-emoji { font-size: 28px; }
.chart-center-pct { font-size: 12px; font-weight: 700; color: var(--text-light); }

.gram-legend { display: flex; flex-direction: column; gap: 8px; }
.legend-item {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 13px;
  font-weight: 500;
}
.legend-dot {
  width: 14px; height: 14px;
  border-radius: 4px;
  flex-shrink: 0;
}
.legend-name { flex: 1; }
.legend-pct { font-weight: 700; }

.gram-tabs {
  display: flex;
  gap: 8px;
  margin-bottom: 16px;
}
.gram-tab {
  flex: 1;
  padding: 8px;
  border: 2px solid #F0EEF5;
  border-radius: 10px;
  background: white;
  font-family: inherit;
  font-size: 13px;
  font-weight: 700;
  cursor: pointer;
  transition: var(--transition);
}
.gram-tab.active {
  border-color: var(--pink);
  background: #FFF0F5;
  color: var(--pink);
}

.top-cats { margin-top: 12px; }
.top-cat-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 0;
  border-bottom: 1px solid #F5F3FA;
}
.top-cat-rank {
  width: 24px; height: 24px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  font-weight: 900;
  color: white;
}
.top-cat-rank.r1 { background: var(--yellow); }
.top-cat-rank.r2 { background: #C0C0C0; }
.top-cat-rank.r3 { background: #CD7F32; }
.top-cat-emoji { font-size: 24px; }
.top-cat-name { flex: 1; font-size: 14px; font-weight: 700; }
.top-cat-paws { font-size: 14px; letter-spacing: 2px; }

/* ===== ACHIEVEMENTS ===== */
.achiev-content { padding: 0 20px 100px; }
.achiev-summary {
  text-align: center;
  margin-bottom: 20px;
  font-size: 14px;
  color: var(--text-light);
  font-weight: 700;
}
.achiev-list { display: flex; flex-direction: column; gap: 10px; }
.achiev-item {
  display: flex;
  align-items: center;
  gap: 14px;
  background: var(--card);
  border-radius: var(--radius-sm);
  padding: 16px;
  box-shadow: var(--shadow);
  transition: var(--transition);
}
.achiev-item.locked { opacity: 0.5; filter: grayscale(0.7); }
.achiev-icon { font-size: 32px; }
.achiev-info { flex: 1; }
.achiev-name { font-size: 14px; font-weight: 900; }
.achiev-cond { font-size: 11px; color: var(--text-light); margin-top: 2px; }
.achiev-status {
  font-size: 20px;
}

/* ===== TOAST ===== */
.toast {
  position: fixed;
  top: 60px;
  left: 50%;
  transform: translateX(-50%) translateY(-100px);
  background: var(--text);
  color: white;
  padding: 12px 24px;
  border-radius: 30px;
  font-size: 14px;
  font-weight: 700;
  z-index: 999;
  transition: transform 0.4s cubic-bezier(0.34,1.56,0.64,1);
  white-space: nowrap;
  box-shadow: var(--shadow-lg);
}
.toast.show { transform: translateX(-50%) translateY(0); }

/* ===== EMPTY STATE ===== */
.empty-state {
  text-align: center;
  padding: 40px 20px;
  color: var(--text-light);
}
.empty-emoji { font-size: 48px; margin-bottom: 12px; }
.empty-text { font-size: 14px; font-weight: 500; line-height: 1.6; }

/* ===== CONFETTI ===== */
.confetti-container {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  pointer-events: none;
  z-index: 200;
}
.confetti-piece {
  position: absolute;
  width: 10px; height: 10px;
  top: -10px;
  animation: confettiFall 3s linear forwards;
}
@keyframes confettiFall {
  0% { transform: translateY(0) rotate(0deg); opacity: 1; }
  100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
}

/* ===== SCROLLBAR ===== */
.screen::-webkit-scrollbar { width: 0; }

/* ===== DECORATIVE PAWS ===== */
.paw-bg {
  position: fixed;
  font-size: 100px;
  opacity: 0.03;
  z-index: 0;
  pointer-events: none;
}
.paw-bg.p1 { top: 10%; right: -20px; transform: rotate(25deg); }
.paw-bg.p2 { bottom: 20%; left: -20px; transform: rotate(-15deg); }
</style>
</head>
<body>
<div id="app">
  <div class="paw-bg p1">ğŸ¾</div>
  <div class="paw-bg p2">ğŸ¾</div>

  <!-- SPLASH -->
  <div id="splash" class="screen active" onclick="startApp()">
    <div class="splash-cat">
      <svg class="cat-silhouette" viewBox="0 0 200 200" fill="#2a2a4e">
        <path d="M40,180 Q30,140 25,120 Q20,80 40,60 L50,30 Q55,25 60,35 L65,55 Q80,45 100,42 Q120,45 135,55 L140,35 Q145,25 150,30 L160,60 Q180,80 175,120 Q170,140 160,180 Z"/>
      </svg>
      <div class="cat-eyes">
        <div class="cat-eye"></div>
        <div class="cat-eye"></div>
      </div>
    </div>
    <div class="splash-logo">NekoLogy</div>
    <div class="splash-sub">çŒ«æˆåˆ†è§£æã‚¢ãƒ—ãƒª</div>
    <div class="splash-tap">ã‚¿ãƒƒãƒ—ã—ã¦ã‚¹ã‚¿ãƒ¼ãƒˆ ğŸ¾</div>
  </div>

  <!-- HOME -->
  <div id="home" class="screen">
    <div class="header">
      <div class="header-logo">ğŸ¾ NekoLogy</div>
      <div class="header-icons">
        <button class="header-icon" onclick="showScreen('achievements')">ğŸ†</button>
      </div>
    </div>
    <div class="home-content">
      <div class="daily-cat-card">
        <div class="daily-label">ğŸ“… æœ¬æ—¥ã®çŒ«æˆåˆ†</div>
        <div class="daily-cat-emoji" id="dailyCatEmoji">ğŸ±</div>
        <div class="daily-cat-name" id="dailyCatName">ã¾ã è¨ºæ–­ã—ã¦ã„ã¾ã›ã‚“</div>
        <div class="daily-cat-desc" id="dailyCatDesc">è¨ºæ–­ã—ã¦çŒ«æˆåˆ†ã‚’è§£æã—ã‚ˆã†ï¼</div>
      </div>
      <div id="streakBadge" class="streak-badge" style="display:none">
        ğŸ”¥ <span id="streakCount">0</span>æ—¥é€£ç¶šãƒ­ã‚°ä¸­ï¼
      </div>
      <div class="menu-grid">
        <div class="menu-card" onclick="showScreen('diagSelect')">
          <span class="mc-emoji">ğŸ¯</span>
          <div class="mc-title">è¨ºæ–­ã™ã‚‹</div>
          <div class="mc-sub">çŒ«ã¨ã®ç›¸æ€§ã¯ï¼Ÿ</div>
        </div>
        <div class="menu-card" onclick="showScreen('nekoLog')">
          <span class="mc-emoji">ğŸ“–</span>
          <div class="mc-title">ãƒã‚³ãƒ­ã‚°</div>
          <div class="mc-sub">ä»Šæ—¥ã®çŒ«è¡Œå‹•</div>
        </div>
        <div class="menu-card" onclick="showScreen('nekogram')">
          <span class="mc-emoji">ğŸ“Š</span>
          <div class="mc-title">ãƒã‚³ã‚°ãƒ©ãƒ </div>
          <div class="mc-sub">çŒ«æˆåˆ†ã®æ¨ç§»</div>
        </div>
        <div class="menu-card" onclick="showScreen('achievements')">
          <span class="mc-emoji">ğŸ†</span>
          <div class="mc-title">å®Ÿç¸¾</div>
          <div class="mc-sub" id="achievCount">0/8 è§£é™¤</div>
        </div>
      </div>
    </div>
    <div class="tab-bar">
      <button class="tab-item active" onclick="showScreen('home')"><span class="tab-icon">ğŸ </span>ãƒ›ãƒ¼ãƒ </button>
      <button class="tab-item" onclick="showScreen('diagSelect')"><span class="tab-icon">ğŸ¯</span>è¨ºæ–­</button>
      <button class="tab-item" onclick="showScreen('nekoLog')"><span class="tab-icon">ğŸ“–</span>ãƒ­ã‚°</button>
      <button class="tab-item" onclick="showScreen('nekogram')"><span class="tab-icon">ğŸ“Š</span>åˆ†æ</button>
      <button class="tab-item" onclick="showScreen('achievements')"><span class="tab-icon">ğŸ†</span>å®Ÿç¸¾</button>
    </div>
  </div>

  <!-- DIAG SELECT -->
  <div id="diagSelect" class="screen">
    <div class="header">
      <button class="back-btn" onclick="showScreen('home')">â† ã‚‚ã©ã‚‹</button>
    </div>
    <div class="diag-select-content">
      <div class="diag-option" onclick="startQuiz('want')">
        <span class="do-emoji">ğŸ˜»</span>
        <div>
          <div class="do-title">é£¼ã„ãŸã„çŒ«è¨ºæ–­</div>
          <div class="do-desc">ã‚ãªãŸã«ã´ã£ãŸã‚Šã®çŒ«ç¨®ã‚’è¦‹ã¤ã‘ã‚ˆã†</div>
          <div class="do-badge">4æŠ Ã— 6å•</div>
        </div>
      </div>
      <div class="diag-option" onclick="startQuiz('become')">
        <span class="do-emoji">ğŸˆâ€â¬›</span>
        <div>
          <div class="do-title">ãªã‚‹çŒ«è¨ºæ–­</div>
          <div class="do-desc">ã‚ãªãŸãŒçŒ«ã«ãªã£ãŸã‚‰ä½•çŒ«ï¼Ÿ</div>
          <div class="do-badge">4æŠ Ã— 6å•</div>
        </div>
      </div>
      <div class="diag-option" id="compatOption" onclick="startCompat()" style="display:none">
        <span class="do-emoji">ğŸ’</span>
        <div>
          <div class="do-title">ç›¸æ€§è¨ºæ–­</div>
          <div class="do-desc">é£¼ã„ãŸã„çŒ« Ã— ãªã‚‹çŒ«ã®ç›¸æ€§ã¯ï¼Ÿ</div>
          <div class="do-badge">çµæœã‚’ä½¿ã£ã¦è§£æ</div>
        </div>
      </div>
    </div>
  </div>

  <!-- QUIZ -->
  <div id="quiz" class="screen">
    <div class="header">
      <button class="back-btn" onclick="showScreen('diagSelect')">â† ã‚„ã‚ã‚‹</button>
    </div>
    <div class="quiz-content">
      <div class="quiz-progress" id="quizProgress"></div>
      <div class="quiz-qnum" id="quizQnum"></div>
      <div class="quiz-question" id="quizQuestion"></div>
      <div class="quiz-options" id="quizOptions"></div>
    </div>
  </div>

  <!-- RESULT -->
  <div id="result" class="screen">
    <div class="header">
      <button class="back-btn" onclick="showScreen('home')">â† ãƒ›ãƒ¼ãƒ ã¸</button>
    </div>
    <div class="result-content" id="resultContent"></div>
  </div>

  <!-- COMPATIBILITY -->
  <div id="compat" class="screen">
    <div class="header">
      <button class="back-btn" onclick="showScreen('home')">â† ãƒ›ãƒ¼ãƒ ã¸</button>
    </div>
    <div class="result-content" id="compatContent"></div>
  </div>

  <!-- NEKO LOG -->
  <div id="nekoLog" class="screen">
    <div class="header">
      <button class="back-btn" onclick="showScreen('home')">â† ã‚‚ã©ã‚‹</button>
      <div style="font-weight:900;font-size:16px">ğŸ“– ãƒã‚³ãƒ­ã‚°</div>
      <div style="width:60px"></div>
    </div>
    <div class="log-content" id="logContent"></div>
    <div class="tab-bar">
      <button class="tab-item" onclick="showScreen('home')"><span class="tab-icon">ğŸ </span>ãƒ›ãƒ¼ãƒ </button>
      <button class="tab-item" onclick="showScreen('diagSelect')"><span class="tab-icon">ğŸ¯</span>è¨ºæ–­</button>
      <button class="tab-item active" onclick="showScreen('nekoLog')"><span class="tab-icon">ğŸ“–</span>ãƒ­ã‚°</button>
      <button class="tab-item" onclick="showScreen('nekogram')"><span class="tab-icon">ğŸ“Š</span>åˆ†æ</button>
      <button class="tab-item" onclick="showScreen('achievements')"><span class="tab-icon">ğŸ†</span>å®Ÿç¸¾</button>
    </div>
  </div>

  <!-- NEKOGRAM -->
  <div id="nekogram" class="screen">
    <div class="header">
      <button class="back-btn" onclick="showScreen('home')">â† ã‚‚ã©ã‚‹</button>
      <div style="font-weight:900;font-size:16px">ğŸ“Š ãƒã‚¤ãƒã‚³ã‚°ãƒ©ãƒ </div>
      <div style="width:60px"></div>
    </div>
    <div class="gram-content" id="gramContent"></div>
    <div class="tab-bar">
      <button class="tab-item" onclick="showScreen('home')"><span class="tab-icon">ğŸ </span>ãƒ›ãƒ¼ãƒ </button>
      <button class="tab-item" onclick="showScreen('diagSelect')"><span class="tab-icon">ğŸ¯</span>è¨ºæ–­</button>
      <button class="tab-item" onclick="showScreen('nekoLog')"><span class="tab-icon">ğŸ“–</span>ãƒ­ã‚°</button>
      <button class="tab-item active" onclick="showScreen('nekogram')"><span class="tab-icon">ğŸ“Š</span>åˆ†æ</button>
      <button class="tab-item" onclick="showScreen('achievements')"><span class="tab-icon">ğŸ†</span>å®Ÿç¸¾</button>
    </div>
  </div>

  <!-- ACHIEVEMENTS -->
  <div id="achievements" class="screen">
    <div class="header">
      <button class="back-btn" onclick="showScreen('home')">â† ã‚‚ã©ã‚‹</button>
      <div style="font-weight:900;font-size:16px">ğŸ† å®Ÿç¸¾</div>
      <div style="width:60px"></div>
    </div>
    <div class="achiev-content" id="achievContent"></div>
    <div class="tab-bar">
      <button class="tab-item" onclick="showScreen('home')"><span class="tab-icon">ğŸ </span>ãƒ›ãƒ¼ãƒ </button>
      <button class="tab-item" onclick="showScreen('diagSelect')"><span class="tab-icon">ğŸ¯</span>è¨ºæ–­</button>
      <button class="tab-item" onclick="showScreen('nekoLog')"><span class="tab-icon">ğŸ“–</span>ãƒ­ã‚°</button>
      <button class="tab-item" onclick="showScreen('nekogram')"><span class="tab-icon">ğŸ“Š</span>åˆ†æ</button>
      <button class="tab-item active" onclick="showScreen('achievements')"><span class="tab-icon">ğŸ†</span>å®Ÿç¸¾</button>
    </div>
  </div>

  <!-- TOAST -->
  <div class="toast" id="toast"></div>
</div>

<script>
// ===== DATA =====
const CAT_BREEDS = {
  want: [
    { id:"scottish", name:"ã‚¹ã‚³ãƒ†ã‚£ãƒƒã‚·ãƒ¥ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰", emoji:"ğŸ˜º", tags:["ç™’ã—","ã¾ã£ãŸã‚Š","å®¤å†…"], color:"#FFB3D0",
      desc:"æŠ˜ã‚Œè€³ãŒæ„›ã‚‰ã—ã„ã€ã¾ã£ãŸã‚Šç™’ã—ç³»ã€‚ã‚ãªãŸã®éš£ã§ã‚´ãƒ­ã‚´ãƒ­è¨€ã„ãªãŒã‚‰ã€ç©ã‚„ã‹ãªæ™‚é–“ã‚’ä¸€ç·’ã«éã”ã—ã¦ãã‚Œã‚‹ã§ã—ã‚‡ã†ã€‚ç”˜ãˆã‚“åŠã ã‘ã©ã€ç¨‹ã‚ˆã„è·é›¢æ„Ÿã‚’ä¿ã¦ã‚‹å¤§äººãªçŒ«ã§ã™ã€‚" },
    { id:"munchkin", name:"ãƒãƒ³ãƒã‚«ãƒ³", emoji:"ğŸ˜¸", tags:["éŠã³å¥½ã","å­çŒ«æ„Ÿ","çŸ­è¶³"], color:"#FFD93D",
      desc:"çŸ­ã„è„šã§ã¡ã‚‡ã“ã¡ã‚‡ã“èµ°ã‚‹å§¿ã¯åå‰‡ç´šã®å¯æ„›ã•ï¼å¥½å¥‡å¿ƒæ—ºç››ã§ã€ã‚ãªãŸã®æ¯æ—¥ã«ç¬‘é¡”ã¨æ´»åŠ›ã‚’ä¸ãˆã¦ãã‚Œã¾ã™ã€‚ãŠã‚‚ã¡ã‚ƒéŠã³ãŒå¤§å¥½ããªæ°¸é ã®å­çŒ«ã§ã™ã€‚" },
    { id:"abyssinian", name:"ã‚¢ãƒ“ã‚·ãƒ‹ã‚¢ãƒ³", emoji:"ğŸ±", tags:["çŸ¥çš„","æ´»ç™º","ãƒ„ãƒ³ãƒ‡ãƒ¬"], color:"#AB83E6",
      desc:"ç¾ã—ã„æ¯›ä¸¦ã¿ã¨çŸ¥çš„ãªçœ¼å·®ã—ã€‚ç‹¬ç«‹å¿ƒãŒã‚ã‚ŠãªãŒã‚‰ã‚‚ã€ä¿¡é ¼ã—ãŸäººã«ã¯ã¨ã“ã¨ã‚“ç”˜ãˆã‚‹ç©¶æ¥µã®ãƒ„ãƒ³ãƒ‡ãƒ¬çŒ«ã€‚ä¸€ç·’ã«æš®ã‚‰ã™ã»ã©ã«æ·±ã¾ã‚‹é–¢ä¿‚ã‚’æ¥½ã—ã‚ã¾ã™ã€‚" },
    { id:"mix", name:"é›‘ç¨®ï¼ˆãƒŸã‚±ï¼‰", emoji:"ğŸˆ", tags:["å€‹æ€§æ´¾","ä¸€æœŸä¸€ä¼š","æ™®é€šãŒæœ€é«˜"], color:"#6BCB77",
      desc:"ä¸–ç•Œã«ãŸã£ãŸä¸€åŒ¹ã®ã€ã‚ãªãŸã ã‘ã®çŒ«ã€‚å€‹æ€§è±Šã‹ã§äºˆæ¸¬ä¸èƒ½ãªé­…åŠ›ã«ã‚ãµã‚Œã¦ã„ã¾ã™ã€‚ç‰¹åˆ¥ãªè¡€çµ±ã˜ã‚ƒãªãã¦ã‚‚ã€ã‚ãªãŸã¨ã®å‡ºä¼šã„ãŒç‰¹åˆ¥ãªã‚“ã§ã™ã€‚" },
    { id:"ragdoll", name:"ãƒ©ã‚°ãƒ‰ãƒ¼ãƒ«", emoji:"ğŸ§¸", tags:["æŠ±ã£ã“å¥½ã","å¤§å‹","ã¬ã„ãã‚‹ã¿"], color:"#4FC3F7",
      desc:"æŠ±ã£ã“ã™ã‚‹ã¨ããŸã£ã¨ãªã‚‹ã€ã¾ã•ã«ã¬ã„ãã‚‹ã¿ã®ã‚ˆã†ãªçŒ«ã€‚å¤§ããªä½“ã§ç”˜ãˆã¦ãã‚‹å§¿ã¯ãŸã¾ã‚Šã¾ã›ã‚“ã€‚ç©ã‚„ã‹ã§å„ªã—ã„æ€§æ ¼ã¯ã€ç™’ã—ã®æ¥µã¿ã§ã™ã€‚" },
    { id:"bengal", name:"ãƒ™ãƒ³ã‚¬ãƒ«", emoji:"ğŸ†", tags:["é‹å‹•ç¥çµŒæŠœç¾¤","ãƒ¯ã‚¤ãƒ«ãƒ‰","ãƒ„ãƒ¤ãƒ„ãƒ¤"], color:"#FF9A56",
      desc:"ãƒ’ãƒ§ã‚¦æŸ„ã®ç¾ã—ã„æ¯›ä¸¦ã¿ã‚’æŒã¤é‡ç”Ÿã®è¡€ã‚’å¼•ãçŒ«ã€‚é‹å‹•èƒ½åŠ›ãŒé«˜ãã€ä¸€ç·’ã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªç”Ÿæ´»ã‚’æ¥½ã—ã‚ã¾ã™ã€‚è¦‹ãŸç›®ã¯ãƒ¯ã‚¤ãƒ«ãƒ‰ã§ã‚‚ã€å®Ÿã¯ç”˜ãˆãŸãŒã‚Šã€‚" },
    { id:"siamese", name:"ã‚·ãƒ£ãƒ ", emoji:"ğŸ˜¼", tags:["ãŠã—ã‚ƒã¹ã‚Š","é ­ãŒè‰¯ã„","ç´°èº«"], color:"#D4A5FF",
      desc:"ã€Œã«ã‚ƒãƒ¼ã‚“ã€ã¨ã‚ˆãè©±ã—ã‹ã‘ã¦ãã‚‹ã€ãŠã—ã‚ƒã¹ã‚ŠçŒ«ã®ä»£è¡¨ã€‚éå¸¸ã«é ­ãŒè‰¯ãã€ã‚ãªãŸã¨ã®ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å¿ƒã‹ã‚‰æ¥½ã—ã‚“ã§ãã‚Œã¾ã™ã€‚å¯‚ã—ãŒã‚Šã‚„ãªä¸€é¢ã‚‚ã€‚" },
    { id:"mainecoon", name:"ãƒ¡ã‚¤ãƒ³ã‚¯ãƒ¼ãƒ³", emoji:"ğŸ¦", tags:["è²«ç¦„","å¤§ãã„","ç©ã‚„ã‹"], color:"#8B87A0",
      desc:"çŒ«ç•Œã®å·¨äººã€ã§ã‚‚å¿ƒã¯ã¨ã£ã¦ã‚‚ç©ã‚„ã‹ã€‚å ‚ã€…ã¨ã—ãŸä½‡ã¾ã„ã®ä¸­ã«ã€çŠ¬ã®ã‚ˆã†ãªå¿ èª å¿ƒã‚’æŒã£ã¦ã„ã¾ã™ã€‚é ¼ã‚Œã‚‹ç›¸æ£’ãŒæ¬²ã—ã„ã‚ãªãŸã«ã´ã£ãŸã‚Šã€‚" }
  ],
  become: [
    { id:"black", name:"é»’çŒ«", emoji:"ğŸˆâ€â¬›", tags:["ãƒ„ãƒ³ãƒ‡ãƒ¬","è¦³å¯Ÿè€…","ç¥ç§˜çš„"], color:"#5C5470",
      desc:"ã‚¯ãƒ¼ãƒ«ãªå¤–è¦‹ã®å¥¥ã«æ¸©ã‹ã„å¿ƒã‚’æŒã¤ã€ãƒŸã‚¹ãƒ†ãƒªã‚¢ã‚¹ãªå­˜åœ¨ã€‚å‘¨ã‚Šã‚’ã‚ˆãè¦³å¯Ÿã—ã¦ã‹ã‚‰è¡Œå‹•ã™ã‚‹æ…é‡æ´¾ã€‚ã§ã‚‚å¿ƒã‚’é–‹ã„ãŸç›¸æ‰‹ã«ã¯ã¨ã“ã¨ã‚“ç”˜ãˆã¾ã™ã€‚" },
    { id:"tora", name:"èŒ¶ãƒˆãƒ©", emoji:"ğŸ±", tags:["äººæ‡ã“ã„","ãƒªãƒ¼ãƒ€ãƒ¼","é£Ÿã„ã—ã‚“åŠ"], color:"#FF9A56",
      desc:"èª°ã«ã§ã‚‚ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ã§ã€ã¿ã‚“ãªã®äººæ°—è€…ï¼é£Ÿã¹ã‚‹ã“ã¨ãŒå¤§å¥½ãã§ã€ãŠã‚„ã¤ã®æ™‚é–“ãŒæœ€é«˜ã®å¹¸ã›ã€‚ãƒ ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼ã¨ã—ã¦ã¿ã‚“ãªã‚’ç¬‘é¡”ã«ã—ã¾ã™ã€‚" },
    { id:"white", name:"ç™½çŒ«", emoji:"ğŸ¤", tags:["æ°—ã¾ãã‚Œ","ç¾äºº","ãƒã‚¤ãƒšãƒ¼ã‚¹"], color:"#E8E0F0",
      desc:"ç¾ã—ãæ°—é«˜ã„ã€ãƒã‚¤ãƒšãƒ¼ã‚¹ã®æ¥µã¿ã€‚è‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã‚’å´©ã•ãªã„å¼·ã•ã‚’æŒã¡ãªãŒã‚‰ã€ãµã¨ã—ãŸç¬é–“ã«è¦‹ã›ã‚‹ç”˜ãˆãŸè¡¨æƒ…ãŒå‘¨ã‚Šã‚’ãƒ¡ãƒ­ãƒ¡ãƒ­ã«ã—ã¾ã™ã€‚" },
    { id:"sabi", name:"ã‚µãƒ“çŒ«", emoji:"ğŸ¾", tags:["è‡ªç”±äºº","å€‹æ€§çš„","æ„å¿—ãŒå¼·ã„"], color:"#CD7F32",
      desc:"ç‹¬ç‰¹ã®æ¯›è‰²ã®ã‚ˆã†ã«ã€å”¯ä¸€ç„¡äºŒã®å€‹æ€§ã®æŒã¡ä¸»ã€‚è‡ªç”±ã‚’æ„›ã—ã€è‡ªåˆ†ã®é“ã‚’è²«ãå¼·ã•ãŒã‚ã‚Šã¾ã™ã€‚ã¡ã‚‡ã£ã¨ä¸å™¨ç”¨ãªæ„›æƒ…è¡¨ç¾ãŒé€†ã«æ„›ãŠã—ã„ã€‚" },
    { id:"kijitora", name:"ã‚­ã‚¸ãƒˆãƒ©", emoji:"ğŸ¯", tags:["é‡ç”Ÿçš„","ç”¨å¿ƒæ·±ã„","è³¢ã„"], color:"#8B6914",
      desc:"é‡ç”Ÿã®è¡€ãŒæ¿ƒãæ®‹ã‚‹ã€è³¢ãã¦ç”¨å¿ƒæ·±ã„çŒ«ã€‚æœ€åˆã¯è­¦æˆ’ã™ã‚‹ã‘ã‚Œã©ã€ä¿¡é ¼ã‚’å‹ã¡å–ã‚Œã°æœ€é«˜ã®ç›¸æ£’ã«ã€‚ç›´æ„ŸãŒé‹­ãã€æœ¬è³ªã‚’è¦‹æŠœãåŠ›ãŒã‚ã‚Šã¾ã™ã€‚" },
    { id:"calico", name:"ä¸‰æ¯›çŒ«", emoji:"ğŸ€", tags:["ã‚ãŒã¾ã¾","æ„›æƒ…æ·±ã„","ãƒ‰ãƒ©ãƒãƒãƒƒã‚¯"], color:"#FF6B9D",
      desc:"æ°—åˆ†å±‹ã§ãƒ‰ãƒ©ãƒãƒãƒƒã‚¯ã€ã§ã‚‚ã¨ã«ã‹ãæ„›æƒ…æ·±ã„ã€‚å–œæ€’å“€æ¥½ãŒã¯ã£ãã‚Šã—ã¦ã„ã¦ã€ä¸€ç·’ã«ã„ã‚‹ã¨é€€å±ˆã—ã¾ã›ã‚“ã€‚å¥³ç‹æ§˜æ°—è³ªã ã‘ã©ã€ãã®é­…åŠ›ã«é€†ã‚‰ãˆãªã„ï¼" }
  ]
};

const QUIZ_DATA = {
  want: [
    { q:"é€±æœ«ã®åˆå¾Œã€ä½•ã—ã¦ã‚‹ï¼Ÿ", opts:["ã‚½ãƒ•ã‚¡ã§ã‚´ãƒ­ã‚´ãƒ­ ğŸ›‹ï¸","å‹é”ã¨éŠã¶ ğŸ‰","ä¸€äººã§è¶£å‘³ã«æ²¡é ­ ğŸ¨","ç‰¹ã«äºˆå®šãªã—æ´¾ ğŸ˜´"],
      points:[ {scottish:3,ragdoll:2,mainecoon:1}, {munchkin:3,bengal:2,siamese:1}, {abyssinian:3,siamese:2,bengal:1}, {mix:3,ragdoll:1,mainecoon:1} ] },
    { q:"çŒ«ã«æ±‚ã‚ã‚‹ä¸€ç•ªã®å½¹å‰²ã¯ï¼Ÿ", opts:["ä¸€ç·’ã«å¯ã¦ãã‚Œã‚‹ç›¸æ£’ ğŸ’¤","è©±ã—ç›¸æ‰‹ã«ãªã£ã¦ã»ã—ã„ ğŸ’¬","å°Šæ•¬ã§ãã‚‹å­˜åœ¨ âœ¨","è¦³å¯Ÿã—ã¦æ¥½ã—ã¿ãŸã„ ğŸ‘€"],
      points:[ {ragdoll:3,scottish:2,mainecoon:1}, {siamese:3,munchkin:2,abyssinian:1}, {abyssinian:3,bengal:2,siamese:1}, {bengal:3,mix:2,abyssinian:1} ] },
    { q:"è§¦ã‚‹ãªã‚‰ã©ã“ï¼Ÿ", opts:["è‚‰çƒ ğŸ¾","è€³ã®è£ ğŸ‘‚","ã—ã£ã½ä»˜ã‘æ ¹ ğŸˆ","ãŠè…¹ ğŸ’•"],
      points:[ {munchkin:3,scottish:2,mix:1}, {abyssinian:3,siamese:2,bengal:1}, {bengal:3,mainecoon:2,mix:1}, {ragdoll:3,munchkin:2,scottish:1} ] },
    { q:"é³´ãå£°ã®å¥½ã¿ã¯ï¼Ÿ", opts:["ã»ã¨ã‚“ã©é³´ã‹ãªã„ ğŸ¤«","ã‚ˆãé³´ã ğŸ˜º","ä½ã„å£° ğŸ”Š","é«˜ã„å£° ğŸ””"],
      points:[ {abyssinian:3,bengal:2,mix:1}, {siamese:3,munchkin:2,ragdoll:1}, {mainecoon:3,bengal:2,mix:1}, {scottish:3,munchkin:2,ragdoll:1} ] },
    { q:"æ¯›è‰²ã®å¥½ã¿ã¯ï¼Ÿ", opts:["ç™½ãƒ»ã‚°ãƒ¬ãƒ¼ç³» ğŸ¤","èŒ¶ãƒ»ã‚­ã‚¸ç³» ğŸ§¡","é»’ãƒ»ã‚µãƒ“ç³» ğŸ–¤","ç‰¹ã«ã“ã ã‚ã‚‰ãªã„ ğŸŒˆ"],
      points:[ {ragdoll:3,scottish:2,siamese:1}, {bengal:3,munchkin:2,abyssinian:1}, {mainecoon:3,mix:2,abyssinian:1}, {mix:3,scottish:1,ragdoll:1} ] },
    { q:"çŒ«ã®å¹´é½¢ã¯ï¼Ÿ", opts:["å­çŒ«ï¼ˆã‚„ã‚“ã¡ã‚ƒï¼‰ğŸ¾","æˆçŒ«ï¼ˆãƒãƒ©ãƒ³ã‚¹ï¼‰ğŸ˜Œ","ã‚·ãƒ‹ã‚¢ï¼ˆè½ã¡ç€ãï¼‰ğŸ§“","ç‰¹ã«å•ã‚ãªã„ ğŸ²"],
      points:[ {munchkin:3,bengal:2,siamese:1}, {scottish:3,abyssinian:2,ragdoll:1}, {mainecoon:3,ragdoll:2,mix:1}, {mix:3,scottish:1,abyssinian:1} ] }
  ],
  become: [
    { q:"é£²ã¿ä¼šã§ã®ãƒã‚¸ã‚·ãƒ§ãƒ³ã¯ï¼Ÿ", opts:["éš…ã§ã‚¹ãƒãƒ› ğŸ“±","å¹¹äº‹ã‚„ã£ã¦ã‚‹ ğŸ“‹","äºŒæ¬¡ä¼šã¾ã§å‚åŠ  ğŸ»","å½“æ—¥ã‚­ãƒ£ãƒ³ã‚»ãƒ« ğŸ’¨"],
      points:[ {black:3,kijitora:2,white:1}, {tora:3,calico:2,sabi:1}, {tora:2,calico:3,black:1}, {white:3,sabi:2,kijitora:1} ] },
    { q:"ã‚¹ãƒˆãƒ¬ã‚¹ç™ºæ•£æ³•ã¯ï¼Ÿ", opts:["ã¨ã«ã‹ãå¯ã‚‹ ğŸ˜´","é«˜ã„ã¨ã“ã‚ã«è¡Œã â›°ï¸","èª°ã‹ã«ç”˜ãˆã‚‹ ğŸ¥º","ä¸€äººéŠã³ã™ã‚‹ ğŸ®"],
      points:[ {tora:3,black:2,calico:1}, {kijitora:3,black:2,sabi:1}, {calico:3,tora:2,white:1}, {sabi:3,kijitora:2,white:1} ] },
    { q:"ç”˜ãˆæ–¹ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯ï¼Ÿ", opts:["å¸¸ã«ãƒ™ã‚¿ãƒ™ã‚¿ ğŸ¾","è‡ªåˆ†ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã ã‘ â°","ç›¸æ‰‹ã«ã‚ˆã‚‹ ğŸ¤”","åŸºæœ¬ç”˜ãˆãªã„ ğŸ˜"],
      points:[ {tora:3,calico:2,white:1}, {black:3,white:2,sabi:1}, {calico:3,kijitora:2,tora:1}, {kijitora:3,sabi:2,black:1} ] },
    { q:"æœã®ç›®è¦šã‚ã¯ï¼Ÿ", opts:["ã‚¹ãƒƒã¨èµ·ãã‚‹ ğŸŒ…","äºŒåº¦å¯ã¯å¿…ãš ğŸ˜ª","èµ·ã“ã•ã‚Œã‚‹ã¾ã§å¯ã‚‹ ğŸ’¤","æ—©èµ·ãã‹ã‚‰ã®äºŒåº¦å¯ ğŸ”„"],
      points:[ {kijitora:3,sabi:2,black:1}, {tora:3,calico:2,white:1}, {white:3,tora:2,calico:1}, {black:3,sabi:2,kijitora:1} ] },
    { q:"äººã«ã©ã†æ€ã‚ã‚ŒãŸã„ï¼Ÿ", opts:["ã‚¯ãƒ¼ãƒ« ğŸ˜","ã‹ã‚ã„ã„ ğŸ¥°","è³¢ã„ ğŸ§ ","è‡ªç”±äºº ğŸ¦‹"],
      points:[ {black:3,kijitora:2,white:1}, {calico:3,tora:2,white:1}, {kijitora:3,black:2,sabi:1}, {sabi:3,white:2,tora:1} ] },
    { q:"ç‹­ã„å ´æ‰€ã‚’è¦‹ã¤ã‘ãŸã‚‰ï¼Ÿ", opts:["å…¥ã‚ŠãŸããªã‚‹ï¼ğŸ“¦","ãªã‚“ã‹è½ã¡ç€ã ğŸ˜Œ","é–‰æ‰€ã¯ãƒ ãƒª ğŸš«","ç‰¹ã«æ°—ã«ã—ãªã„ ğŸ¤·"],
      points:[ {black:3,tora:2,calico:1}, {kijitora:3,sabi:2,black:1}, {white:3,calico:2,tora:1}, {sabi:3,white:2,tora:1} ] }
  ]
};

const LOG_ITEMS = [
  { text:"æ—¥å‘ã¼ã£ã“ã—ãŸ", emoji:"â˜€ï¸", cats:{tora:2,white:2,calico:1} },
  { text:"ä¼¸ã³ã‚’ã—ãŸã‚‰å£°ãŒå‡ºãŸ", emoji:"ğŸ™†", cats:{tora:3,calico:2,sabi:1} },
  { text:"äººã®ä½œæ¥­ã‚’å¦¨å®³ã—ãŸ", emoji:"ğŸ˜ˆ", cats:{calico:3,black:2,tora:1} },
  { text:"ç®±ã‚„è¢‹ãŒã‚ã£ãŸã‚‰å…¥ã£ãŸ", emoji:"ğŸ“¦", cats:{black:3,kijitora:2,sabi:1} },
  { text:"æ€¥ã«èµ°ã‚Šå‡ºã—ãŸ", emoji:"ğŸ’¨", cats:{kijitora:3,sabi:2,tora:1} },
  { text:"çŸ¥ã‚‰ãªã„å ´æ‰€ã§å¯ãŸ", emoji:"ğŸ˜´", cats:{white:3,sabi:2,black:1} },
  { text:"ç”˜ãˆãŸã‹ã¨æ€ã£ãŸã‚‰é›¢ã‚ŒãŸ", emoji:"ğŸ’«", cats:{black:3,white:2,calico:1} },
  { text:"é«˜ã„ã¨ã“ã‚ã«ç™»ã‚ŠãŸããªã£ãŸ", emoji:"ğŸ”ï¸", cats:{kijitora:3,black:2,sabi:1} }
];

const ACHIEVEMENTS = [
  { id:"first", name:"ã¯ã˜ã‚ã¦ã®ã«ã‚ƒã‚“", cond:"åˆå›è¨ºæ–­ã‚’å®Œäº†", emoji:"ğŸ¾", check:d=>d.diagCount>0 },
  { id:"earlybird", name:"æœæ—¥ã¨ã¨ã‚‚ã«", cond:"æ—©æœ(5-7æ™‚)ã«3æ—¥ãƒ­ã‚°ã‚¤ãƒ³", emoji:"ğŸŒ…", check:d=>d.earlyLogins>=3 },
  { id:"boxcat", name:"æ®µãƒœãƒ¼ãƒ«å¸‚æ°‘", cond:"ã€Œç®±/è¢‹ã«å…¥ã‚‹ã€ã‚’3å›è¨˜éŒ²", emoji:"ğŸ“¦", check:d=>(d.logCounts[3]||0)>=3 },
  { id:"disturb", name:"é£¼ã„ä¸»æ”¯é…", cond:"ã€Œä½œæ¥­å¦¨å®³ã€ã‚’5å›è¨˜éŒ²", emoji:"ğŸ˜ˆ", check:d=>(d.logCounts[2]||0)>=5 },
  { id:"zoomies", name:"å¤œã®é‹å‹•ä¼š", cond:"22æ™‚ä»¥é™ã«ã€Œæ€¥ã«èµ°ã‚‹ã€ã‚’è¨˜éŒ²", emoji:"ğŸŒ™", check:d=>d.nightZoomies>0 },
  { id:"reborn", name:"è»¢ç”Ÿä¸­", cond:"7æ—¥é€£ç¶šãƒã‚³ãƒ­ã‚°è¨˜éŒ²", emoji:"ğŸ”„", check:d=>d.streak>=7 },
  { id:"tsundere", name:"ãƒ„ãƒ³ãƒ‡ãƒ¬ãƒã‚¹ã‚¿ãƒ¼", cond:"ã€Œç”˜ãˆãŸâ†’é›¢ã‚ŒãŸã€ã‚’10å›", emoji:"ğŸ’•", check:d=>(d.logCounts[6]||0)>=10 },
  { id:"complete", name:"çŒ«åˆè¦‹ç¿’ã„", cond:"å…¨è¨ºæ–­ã‚’ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆ", emoji:"ğŸ±â€ğŸ‘¤", check:d=>d.wantCat&&d.becomeCat }
];

const COMPAT_MSGS = {
  high: [
    "æœ€é«˜ã®çµ„ã¿åˆã‚ã›ï¼ã‚ãªãŸã¨çŒ«ã¯ã€å‰ä¸–ã§ä¸€ç·’ã«æš®ã‚‰ã—ã¦ã„ãŸã«é•ã„ãªã„ã€‚äº’ã„ã®æ³¢é•·ãŒã´ã£ãŸã‚Šåˆã£ã¦ã€è¨€è‘‰ãŒãªãã¦ã‚‚é€šã˜åˆãˆã‚‹é–¢ä¿‚ã§ã™ã€‚",
    "ã“ã‚Œã¯ã‚‚ã†é‹å‘½ï¼çŒ«ãŒã‚ãªãŸã‚’é¸ã‚“ã ã®ã‹ã€ã‚ãªãŸãŒçŒ«ã‚’é¸ã‚“ã ã®ã‹ã€‚ã©ã¡ã‚‰ã«ã›ã‚ˆã€ã“ã®å‡ºä¼šã„ã¯å¿…ç„¶ã§ã—ãŸã€‚"
  ],
  mid: [
    "ãªã‹ãªã‹ã®ç›¸æ€§ï¼æœ€åˆã¯ã¡ã‚‡ã£ã¨ãã“ã¡ãªã„ã‹ã‚‚ã—ã‚Œãªã„ã‘ã©ã€ä¸€ç·’ã«éã”ã™ã†ã¡ã«ã©ã‚“ã©ã‚“å¿ƒãŒé€šã˜åˆã†ã‚¿ã‚¤ãƒ—ã€‚ãŠäº’ã„ã®å€‹æ€§ã‚’å°Šé‡ã—åˆãˆã¾ã™ã€‚",
    "ã„ã„æ„Ÿã˜ã®ãƒãƒ©ãƒ³ã‚¹ï¼é©åº¦ãªè·é›¢æ„Ÿã‚’ä¿ã¡ãªãŒã‚‰ã€å¤§åˆ‡ãªæ™‚ã¯ãã°ã«ã„ã¦ãã‚Œã‚‹ã€‚é•·ãä»˜ãåˆã†ã»ã©å‘³ãŒå‡ºã‚‹é–¢ä¿‚ã§ã™ã€‚"
  ],
  low: [
    "æ„å¤–ãªçµ„ã¿åˆã‚ã›â€¦ã ã‘ã©ã€ã ã‹ã‚‰ã“ãé¢ç™½ã„ï¼æ­£åå¯¾ã ã‹ã‚‰ã“ãåˆºæ¿€ã—åˆãˆã‚‹é–¢ä¿‚ã€‚ãŠäº’ã„ã®ä¸–ç•Œã‚’åºƒã’ã¦ãã‚Œã‚‹ç›¸æ£’ã«ãªã‚‹ã¯ãšã€‚",
    "ã¡ã‚‡ã£ã¨ã¶ã¤ã‹ã‚‹ã“ã¨ã‚‚ã‚ã‚‹ã‹ã‚‚ï¼Ÿã§ã‚‚ã€ãã‚ŒãŒæ„›ã£ã¦ã‚‚ã®ã§ã™ã€‚æ™‚é–“ã‚’ã‹ã‘ã¦ç¯‰ãçµ†ã¯ã€èª°ã‚ˆã‚Šã‚‚å¼·ããªã‚Šã¾ã™ã€‚"
  ]
};

// ===== STATE =====
let state = {
  wantCat: null,
  becomeCat: null,
  wantScores: {},
  becomeScores: {},
  diagCount: 0,
  logs: {},
  logCounts: {},
  achievUnlocked: [],
  earlyLogins: 0,
  nightZoomies: 0,
  streak: 0,
  lastLogDate: null
};

let currentQuiz = null;
let currentQIndex = 0;
let currentAnswers = [];

// ===== STORAGE =====
function saveState() {
  try { localStorage.setItem('nekology_state', JSON.stringify(state)); } catch(e) {}
}
function loadState() {
  try {
    const s = localStorage.getItem('nekology_state');
    if (s) state = { ...state, ...JSON.parse(s) };
  } catch(e) {}
}

// ===== SCREENS =====
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => { s.classList.remove('active','fade-in'); });
  const screen = document.getElementById(id);
  screen.classList.add('active','fade-in');
  screen.scrollTop = 0;
  if (id === 'home') renderHome();
  if (id === 'nekoLog') renderNekoLog();
  if (id === 'nekogram') renderNekogram();
  if (id === 'achievements') renderAchievements();
  if (id === 'diagSelect') renderDiagSelect();
}

function startApp() {
  loadState();
  checkEarlyLogin();
  showScreen('home');
}

function checkEarlyLogin() {
  const h = new Date().getHours();
  if (h >= 5 && h < 7) {
    const today = dateKey();
    const key = 'early_' + today;
    if (!localStorage.getItem(key)) {
      localStorage.setItem(key, '1');
      state.earlyLogins = (state.earlyLogins || 0) + 1;
      saveState();
    }
  }
}

function dateKey(d) {
  const dt = d || new Date();
  return dt.getFullYear() + '-' + String(dt.getMonth()+1).padStart(2,'0') + '-' + String(dt.getDate()).padStart(2,'0');
}

// ===== HOME =====
function renderHome() {
  const dailyEmoji = document.getElementById('dailyCatEmoji');
  const dailyName = document.getElementById('dailyCatName');
  const dailyDesc = document.getElementById('dailyCatDesc');
  
  if (state.becomeCat) {
    const cat = CAT_BREEDS.become.find(c => c.id === state.becomeCat);
    if (cat) {
      dailyEmoji.textContent = cat.emoji;
      dailyName.textContent = cat.name + 'æˆåˆ†ãŒæ¿ƒã„ã‚';
      const msgs = [
        'ä»Šæ—¥ã‚‚ãƒã‚¤ãƒšãƒ¼ã‚¹ã«è¡Œã“ã† ğŸ¾',
        'æ°—ã®å‘ãã¾ã¾ã«éã”ã™æ—¥ â˜€ï¸',
        'ã¡ã‚‡ã£ã¨ç”˜ãˆãŸã„æ°—åˆ†ã‹ã‚‚ï¼Ÿ',
        'çª“éš›ã®ãƒã‚¸ã‚·ãƒ§ãƒ³ãŒæœ€é«˜ã®æ—¥',
        'ä»Šæ—¥ã®ã‚ãªãŸã¯ã„ã„æ„Ÿã˜ âœ¨'
      ];
      dailyDesc.textContent = msgs[Math.floor(Math.random() * msgs.length)];
    }
  }
  
  // Streak
  const streak = document.getElementById('streakBadge');
  const streakNum = document.getElementById('streakCount');
  if (state.streak > 0) {
    streak.style.display = 'inline-flex';
    streakNum.textContent = state.streak;
  }
  
  // Achiev count
  document.getElementById('achievCount').textContent = state.achievUnlocked.length + '/8 è§£é™¤';
}

// ===== DIAGNOSIS SELECT =====
function renderDiagSelect() {
  const compat = document.getElementById('compatOption');
  if (state.wantCat && state.becomeCat) {
    compat.style.display = 'flex';
  }
}

// ===== QUIZ =====
function startQuiz(type) {
  currentQuiz = type;
  currentQIndex = 0;
  currentAnswers = [];
  showScreen('quiz');
  renderQuiz();
}

function renderQuiz() {
  const data = QUIZ_DATA[currentQuiz];
  const q = data[currentQIndex];
  
  // Progress dots
  const prog = document.getElementById('quizProgress');
  prog.innerHTML = data.map((_, i) => {
    let cls = 'quiz-dot';
    if (i < currentQIndex) cls += ' done';
    if (i === currentQIndex) cls += ' current';
    return `<div class="${cls}"></div>`;
  }).join('');
  
  document.getElementById('quizQnum').textContent = `Q${currentQIndex + 1} / ${data.length}`;
  document.getElementById('quizQuestion').textContent = q.q;
  
  const opts = document.getElementById('quizOptions');
  opts.innerHTML = q.opts.map((o, i) => `
    <button class="quiz-opt" onclick="selectAnswer(${i})">
      <span class="opt-num">${['A','B','C','D'][i]}</span>
      <span>${o}</span>
    </button>
  `).join('');
}

function selectAnswer(idx) {
  currentAnswers.push(idx);
  
  // Highlight
  document.querySelectorAll('.quiz-opt').forEach((b,i) => {
    if (i === idx) b.classList.add('selected');
    b.style.pointerEvents = 'none';
  });
  
  setTimeout(() => {
    currentQIndex++;
    if (currentQIndex >= QUIZ_DATA[currentQuiz].length) {
      finishQuiz();
    } else {
      renderQuiz();
    }
  }, 400);
}

function finishQuiz() {
  const data = QUIZ_DATA[currentQuiz];
  const breeds = currentQuiz === 'want' ? CAT_BREEDS.want : CAT_BREEDS.become;
  const scores = {};
  breeds.forEach(b => scores[b.id] = 0);
  
  currentAnswers.forEach((ans, qi) => {
    const pts = data[qi].points[ans];
    if (pts) {
      Object.entries(pts).forEach(([k,v]) => {
        if (scores[k] !== undefined) scores[k] += v;
      });
    }
  });
  
  // Sort
  const sorted = Object.entries(scores).sort((a,b) => b[1] - a[1]);
  const winner = sorted[0][0];
  const totalPts = sorted.reduce((s,e) => s + e[1], 0) || 1;
  
  if (currentQuiz === 'want') {
    state.wantCat = winner;
    state.wantScores = scores;
  } else {
    state.becomeCat = winner;
    state.becomeScores = scores;
  }
  state.diagCount++;
  saveState();
  
  showResult(currentQuiz, winner, sorted, totalPts);
  checkAchievements();
}

function showResult(type, winnerId, sorted, totalPts) {
  const breeds = type === 'want' ? CAT_BREEDS.want : CAT_BREEDS.become;
  const cat = breeds.find(b => b.id === winnerId);
  const label = type === 'want' ? 'ã‚ãªãŸãŒé£¼ã†ã¹ãçŒ«ã¯â€¦' : 'ã‚ãªãŸãŒçŒ«ã«ãªã£ãŸã‚‰â€¦';
  const colors = ['#FF6B9D','#FF9A56','#FFD93D','#6BCB77','#4FC3F7','#AB83E6','#D4A5FF','#8B87A0'];
  
  const top = sorted.slice(0, Math.min(5, sorted.length)).filter(e => e[1] > 0);
  
  const barsHtml = top.map((e, i) => {
    const b = breeds.find(x => x.id === e[0]);
    const pct = Math.round(e[1] / totalPts * 100);
    return `<div class="bar-item">
      <span class="bar-label">${b ? b.emoji + ' ' + b.name : e[0]}</span>
      <div class="bar-track"><div class="bar-fill" style="background:${colors[i]}" data-width="${pct}%"></div></div>
      <span class="bar-pct">${pct}%</span>
    </div>`;
  }).join('');
  
  const content = document.getElementById('resultContent');
  content.innerHTML = `
    <div class="result-card">
      <div class="result-label">${label}</div>
      <div class="result-emoji">${cat.emoji}</div>
      <div class="result-name">${cat.name}</div>
      <div class="result-tags">${cat.tags.map(t => `<span class="result-tag">#${t}</span>`).join('')}</div>
      <div class="result-desc">${cat.desc}</div>
      <div class="result-bars">${barsHtml}</div>
    </div>
    ${state.wantCat && state.becomeCat ? `<button class="action-btn btn-accent" onclick="startCompat()">ğŸ’ ç›¸æ€§è¨ºæ–­ã‚’è¦‹ã‚‹</button>` : ''}
    <button class="action-btn btn-secondary" onclick="showScreen('diagSelect')">ã‚‚ã†ä¸€åº¦è¨ºæ–­ã™ã‚‹</button>
    <button class="action-btn btn-secondary" onclick="showScreen('home')">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</button>
  `;
  
  showScreen('result');
  spawnConfetti();
  
  // Animate bars
  setTimeout(() => {
    content.querySelectorAll('.bar-fill').forEach(bar => {
      bar.style.width = bar.dataset.width;
    });
  }, 300);
}

// ===== COMPATIBILITY =====
function startCompat() {
  if (!state.wantCat || !state.becomeCat) {
    showToast('å…ˆã«ä¸¡æ–¹ã®è¨ºæ–­ã‚’å®Œäº†ã—ã¦ã­ï¼');
    return;
  }
  
  const wCat = CAT_BREEDS.want.find(c => c.id === state.wantCat);
  const bCat = CAT_BREEDS.become.find(c => c.id === state.becomeCat);
  
  // Compat score based on tag overlap and special combos
  const compatMap = {
    'scottish+black':78, 'scottish+tora':90, 'scottish+white':72, 'scottish+sabi':60, 'scottish+kijitora':68, 'scottish+calico':82,
    'munchkin+black':70, 'munchkin+tora':95, 'munchkin+white':65, 'munchkin+sabi':72, 'munchkin+kijitora':68, 'munchkin+calico':88,
    'abyssinian+black':88, 'abyssinian+tora':65, 'abyssinian+white':70, 'abyssinian+sabi':82, 'abyssinian+kijitora':90, 'abyssinian+calico':60,
    'mix+black':80, 'mix+tora':85, 'mix+white':75, 'mix+sabi':88, 'mix+kijitora':82, 'mix+calico':78,
    'ragdoll+black':65, 'ragdoll+tora':88, 'ragdoll+white':82, 'ragdoll+sabi':58, 'ragdoll+kijitora':62, 'ragdoll+calico':90,
    'bengal+black':82, 'bengal+tora':70, 'bengal+white':55, 'bengal+sabi':85, 'bengal+kijitora':92, 'bengal+calico':65,
    'siamese+black':90, 'siamese+tora':72, 'siamese+white':80, 'siamese+sabi':68, 'siamese+kijitora':75, 'siamese+calico':85,
    'mainecoon+black':75, 'mainecoon+tora':82, 'mainecoon+white':70, 'mainecoon+sabi':78, 'mainecoon+kijitora':85, 'mainecoon+calico':72
  };
  
  const key = state.wantCat + '+' + state.becomeCat;
  const score = compatMap[key] || (60 + Math.floor(Math.random() * 30));
  
  let msgPool;
  if (score >= 85) msgPool = COMPAT_MSGS.high;
  else if (score >= 70) msgPool = COMPAT_MSGS.mid;
  else msgPool = COMPAT_MSGS.low;
  const msg = msgPool[Math.floor(Math.random() * msgPool.length)];
  
  const content = document.getElementById('compatContent');
  content.innerHTML = `
    <div class="result-card">
      <div class="result-label">ğŸ’ ç›¸æ€§è¨ºæ–­çµæœ</div>
      <div class="compat-pair">
        <div class="compat-cat">
          <span class="compat-cat-emoji">${wCat.emoji}</span>
          <span class="compat-cat-name">${wCat.name}</span>
        </div>
        <span class="compat-x">Ã—</span>
        <div class="compat-cat">
          <span class="compat-cat-emoji">${bCat.emoji}</span>
          <span class="compat-cat-name">${bCat.name}</span>
        </div>
      </div>
      <div class="compat-hearts">ğŸ’•</div>
      <div class="compat-score">${score}%</div>
      <div class="compat-msg">${msg}</div>
    </div>
    <button class="action-btn btn-primary" onclick="showScreen('diagSelect')">ã‚‚ã†ä¸€åº¦è¨ºæ–­ã™ã‚‹</button>
    <button class="action-btn btn-secondary" onclick="showScreen('home')">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</button>
  `;
  
  showScreen('compat');
  spawnConfetti();
}

// ===== NEKO LOG =====
function renderNekoLog() {
  const today = dateKey();
  const todayLog = state.logs[today] || new Array(LOG_ITEMS.length).fill(false);
  
  const d = new Date();
  const dateStr = `${d.getFullYear()}/${d.getMonth()+1}/${d.getDate()}ï¼ˆ${'æ—¥æœˆç«æ°´æœ¨é‡‘åœŸ'[d.getDay()]}ï¼‰`;
  
  const checksHtml = LOG_ITEMS.map((item, i) => `
    <div class="log-check ${todayLog[i] ? 'checked' : ''}" onclick="toggleLogItem(${i})">
      <div class="log-checkbox">${todayLog[i] ? 'âœ“' : ''}</div>
      <span class="log-check-text">${item.text}</span>
      <span class="log-check-emoji">${item.emoji}</span>
    </div>
  `).join('');
  
  // Calculate today's cat ratios
  const ratios = calcLogRatios(todayLog);
  const ratioHtml = ratios.length > 0 ? ratios.slice(0, 3).map(r => {
    const cat = CAT_BREEDS.become.find(c => c.id === r.id);
    return `<div class="bar-item">
      <span class="bar-label">${cat.emoji} ${cat.name}</span>
      <div class="bar-track"><div class="bar-fill" style="background:${cat.color};width:${r.pct}%"></div></div>
      <span class="bar-pct">${r.pct}%</span>
    </div>`;
  }).join('') : '<div style="text-align:center;color:var(--text-light);font-size:13px;padding:10px">ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã¨çŒ«åº¦ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>';
  
  document.getElementById('logContent').innerHTML = `
    <div class="log-date">ğŸ“… ${dateStr}</div>
    <div class="log-checks">${checksHtml}</div>
    <div class="log-result-card">
      <div class="log-result-title">ğŸ¾ ä»Šæ—¥ã®çŒ«åº¦</div>
      ${ratioHtml}
    </div>
    <button class="action-btn btn-primary" style="margin-top:16px" onclick="saveLog()">ğŸ“ ä¿å­˜ã™ã‚‹</button>
  `;
}

function toggleLogItem(idx) {
  const today = dateKey();
  if (!state.logs[today]) state.logs[today] = new Array(LOG_ITEMS.length).fill(false);
  state.logs[today][idx] = !state.logs[today][idx];
  saveState();
  renderNekoLog();
}

function saveLog() {
  const today = dateKey();
  const log = state.logs[today];
  if (!log || !log.some(v => v)) {
    showToast('1ã¤ä»¥ä¸Šãƒã‚§ãƒƒã‚¯ã—ã¦ã«ã‚ƒï¼ğŸ±');
    return;
  }
  
  // Update log counts
  if (!state.logCounts) state.logCounts = {};
  log.forEach((checked, i) => {
    if (checked) state.logCounts[i] = (state.logCounts[i] || 0) + 1;
  });
  
  // Night zoomies check (item index 4 = æ€¥ã«èµ°ã‚Šå‡ºã—ãŸ)
  const h = new Date().getHours();
  if (h >= 22 && log[4]) {
    state.nightZoomies = (state.nightZoomies || 0) + 1;
  }
  
  // Streak
  const yesterday = dateKey(new Date(Date.now() - 86400000));
  if (state.lastLogDate === yesterday) {
    state.streak++;
  } else if (state.lastLogDate !== today) {
    state.streak = 1;
  }
  state.lastLogDate = today;
  
  saveState();
  checkAchievements();
  showToast('ä¿å­˜ã—ã¾ã—ãŸï¼ğŸ¾');
}

function calcLogRatios(log) {
  const scores = {};
  log.forEach((checked, i) => {
    if (checked) {
      Object.entries(LOG_ITEMS[i].cats).forEach(([catId, pts]) => {
        scores[catId] = (scores[catId] || 0) + pts;
      });
    }
  });
  const total = Object.values(scores).reduce((s, v) => s + v, 0) || 1;
  return Object.entries(scores)
    .map(([id, pts]) => ({ id, pct: Math.round(pts / total * 100) }))
    .sort((a, b) => b.pct - a.pct);
}

// ===== NEKOGRAM =====
function renderNekogram() {
  const content = document.getElementById('gramContent');
  
  // Aggregate all log data
  const allScores = {};
  const logDates = Object.keys(state.logs).sort();
  
  if (logDates.length === 0) {
    content.innerHTML = `
      <div class="empty-state">
        <div class="empty-emoji">ğŸ“Š</div>
        <div class="empty-text">ã¾ã ãƒã‚³ãƒ­ã‚°ã®è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚<br>æ¯æ—¥ã®çŒ«è¡Œå‹•ã‚’è¨˜éŒ²ã—ã¦ã€<br>ã‚ãªãŸã®çŒ«æˆåˆ†ã‚’è§£æã—ã‚ˆã†ï¼</div>
        <button class="action-btn btn-primary" style="margin-top:20px" onclick="showScreen('nekoLog')">ğŸ“– ãƒã‚³ãƒ­ã‚°ã‚’è¨˜éŒ²ã™ã‚‹</button>
      </div>
    `;
    return;
  }
  
  logDates.forEach(date => {
    const log = state.logs[date];
    const ratios = calcLogRatios(log);
    ratios.forEach(r => {
      allScores[r.id] = (allScores[r.id] || 0) + r.pct;
    });
  });
  
  const total = Object.values(allScores).reduce((s, v) => s + v, 0) || 1;
  const sorted = Object.entries(allScores)
    .map(([id, pts]) => ({ id, pct: Math.round(pts / total * 100) }))
    .sort((a, b) => b.pct - a.pct);
  
  const colors = ['#FF6B9D','#FF9A56','#FFD93D','#6BCB77','#4FC3F7','#AB83E6'];
  
  // Pie chart via canvas
  const canvasId = 'pieChart' + Date.now();
  
  const legendHtml = sorted.map((r, i) => {
    const cat = CAT_BREEDS.become.find(c => c.id === r.id);
    return `<div class="legend-item">
      <div class="legend-dot" style="background:${colors[i % colors.length]}"></div>
      <span class="legend-name">${cat ? cat.emoji + ' ' + cat.name : r.id}</span>
      <span class="legend-pct">${r.pct}%</span>
    </div>`;
  }).join('');
  
  const topCat = sorted[0];
  const topCatData = CAT_BREEDS.become.find(c => c.id === topCat.id);
  
  const topHtml = sorted.slice(0, 3).map((r, i) => {
    const cat = CAT_BREEDS.become.find(c => c.id === r.id);
    const paws = 'ğŸ¾'.repeat(Math.max(1, Math.round(r.pct / 20)));
    return `<div class="top-cat-item">
      <div class="top-cat-rank r${i+1}">${i+1}</div>
      <span class="top-cat-emoji">${cat ? cat.emoji : 'ğŸ±'}</span>
      <span class="top-cat-name">${cat ? cat.name : r.id}</span>
      <span class="top-cat-paws">${paws}</span>
    </div>`;
  }).join('');
  
  content.innerHTML = `
    <div class="gram-card">
      <div class="gram-title">ğŸ¯ çŒ«æˆåˆ†ãƒãƒ£ãƒ¼ãƒˆ</div>
      <div class="chart-container">
        <canvas id="${canvasId}" width="200" height="200" class="chart-canvas"></canvas>
        <div class="chart-center">
          <div class="chart-center-emoji">${topCatData ? topCatData.emoji : 'ğŸ±'}</div>
          <div class="chart-center-pct">${topCat.pct}%</div>
        </div>
      </div>
      <div class="gram-legend">${legendHtml}</div>
    </div>
    <div class="gram-card">
      <div class="gram-title">ğŸ† çŒ«æˆåˆ†ãƒ©ãƒ³ã‚­ãƒ³ã‚°</div>
      <div class="top-cats">${topHtml}</div>
    </div>
    <div class="gram-card">
      <div class="gram-title">ğŸ“… è¨˜éŒ²æ—¥æ•°</div>
      <div style="text-align:center;font-size:36px;font-weight:900;color:var(--pink)">${logDates.length}<span style="font-size:16px;color:var(--text-light)"> æ—¥</span></div>
    </div>
  `;
  
  // Draw pie
  setTimeout(() => drawPie(canvasId, sorted, colors), 100);
}

function drawPie(canvasId, data, colors) {
  const canvas = document.getElementById(canvasId);
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  const dpr = window.devicePixelRatio || 1;
  canvas.width = 200 * dpr;
  canvas.height = 200 * dpr;
  ctx.scale(dpr, dpr);
  
  const cx = 100, cy = 100, r = 80, ir = 50;
  let start = -Math.PI / 2;
  
  data.forEach((d, i) => {
    const angle = (d.pct / 100) * Math.PI * 2;
    ctx.beginPath();
    ctx.moveTo(cx + ir * Math.cos(start), cy + ir * Math.sin(start));
    ctx.arc(cx, cy, r, start, start + angle);
    ctx.arc(cx, cy, ir, start + angle, start, true);
    ctx.closePath();
    ctx.fillStyle = colors[i % colors.length];
    ctx.fill();
    start += angle;
  });
}

// ===== ACHIEVEMENTS =====
function renderAchievements() {
  const content = document.getElementById('achievContent');
  
  const listHtml = ACHIEVEMENTS.map(a => {
    const unlocked = state.achievUnlocked.includes(a.id);
    return `<div class="achiev-item ${unlocked ? '' : 'locked'}">
      <span class="achiev-icon">${a.emoji}</span>
      <div class="achiev-info">
        <div class="achiev-name">${a.name}</div>
        <div class="achiev-cond">${a.cond}</div>
      </div>
      <span class="achiev-status">${unlocked ? 'âœ…' : 'ğŸ”’'}</span>
    </div>`;
  }).join('');
  
  content.innerHTML = `
    <div class="achiev-summary">${state.achievUnlocked.length} / ${ACHIEVEMENTS.length} è§£é™¤æ¸ˆã¿</div>
    <div class="achiev-list">${listHtml}</div>
  `;
}

function checkAchievements() {
  ACHIEVEMENTS.forEach(a => {
    if (!state.achievUnlocked.includes(a.id) && a.check(state)) {
      state.achievUnlocked.push(a.id);
      saveState();
      showToast(`ğŸ† å®Ÿç¸¾è§£é™¤ï¼ã€Œ${a.name}ã€`);
    }
  });
}

// ===== UTILS =====
function showToast(msg) {
  const toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 2500);
}

function spawnConfetti() {
  const container = document.createElement('div');
  container.className = 'confetti-container';
  document.getElementById('app').appendChild(container);
  
  const emojis = ['ğŸ¾','âœ¨','ğŸ’–','ğŸ±','â­','ğŸ€','ğŸ’«'];
  for (let i = 0; i < 30; i++) {
    const piece = document.createElement('div');
    piece.className = 'confetti-piece';
    piece.textContent = emojis[Math.floor(Math.random() * emojis.length)];
    piece.style.left = Math.random() * 100 + '%';
    piece.style.fontSize = (12 + Math.random() * 16) + 'px';
    piece.style.animationDuration = (2 + Math.random() * 2) + 's';
    piece.style.animationDelay = Math.random() * 0.8 + 's';
    container.appendChild(piece);
  }
  setTimeout(() => container.remove(), 4000);
}

// Init
loadState();
</script>
</body>
</html>
